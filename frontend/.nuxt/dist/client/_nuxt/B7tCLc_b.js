import{_ as te}from"./BVOVxMHc.js";import{af as oe,ab as ne,x as se,r as b,a0 as T,N as re,w as ae,a as de,c as le,e as Y,ac as ie,f as a,i as e,z as d,A as p,C as m,H as l,ad as u,k as x,F as C,B as _,ae as U}from"./DnNEn_NX.js";const ue={class:"p-8"},me={class:"mb-6"},ce={class:"text-2xl font-bold text-gray-900"},be={key:0,class:"flex items-center justify-center py-12"},ge={key:1,class:"space-y-8"},fe={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},xe={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ye={class:"bg-gray-50 rounded-lg p-6 shadow-sm mb-6"},ve={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},we=["value"],he=["disabled"],ke=["value"],Ne=["disabled"],Ce=["value"],_e={key:0,class:"mt-1 text-sm text-red-600"},Ae={key:0,class:"mt-1 text-sm text-red-600"},Se={class:"flex justify-end mt-4"},Be=["disabled"],Le={class:"bg-white rounded-lg border border-gray-200"},Te={class:"overflow-x-auto"},Ue={class:"w-full"},Me={key:0},Ve={class:"p-4 text-sm text-gray-900"},$e={class:"flex items-center"},Pe={key:0,class:"ml-2 px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full"},He={class:"p-4 text-sm text-gray-900"},Re={class:"p-4 text-center"},Ie={class:"flex justify-center gap-2 flex-wrap"},De=["onClick"],Ee={key:1,class:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded"},je=["onClick"],Ye=["onClick"],Ze={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ze={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Fe={class:"flex justify-end gap-4"},qe=["disabled"],Ke={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Oe={key:2,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Qe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Xe={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},Ge={class:"space-y-4"},tt={__name:"basic-info",setup(We){const M=oe(),V=ne(),$=ie(),{$swal:h}=se(),A=b(!0),y=b(!1),S=b(!1),r=T({id:null,name:"",area:"",member_count:"",chairman_name:"",chairman_phone:"",address:"",representative:""}),n=T({county:"",district:"",section:"",landNumberMain:"",landNumberSub:"",landArea:""}),c=T({main:"",sub:""}),i=b([]),f=b({}),P=b([{code:"TPE",name:"臺北市"},{code:"KHH",name:"高雄市"},{code:"TPH",name:"新北市"},{code:"TCH",name:"臺中市"},{code:"TNN",name:"臺南市"},{code:"TYC",name:"桃園市"},{code:"HSC",name:"新竹市"},{code:"HSH",name:"新竹縣"},{code:"MIA",name:"苗栗縣"},{code:"CHA",name:"彰化縣"},{code:"NTO",name:"南投縣"},{code:"YUN",name:"雲林縣"},{code:"CYI",name:"嘉義市"},{code:"CYQ",name:"嘉義縣"},{code:"PIF",name:"屏東縣"},{code:"ILA",name:"宜蘭縣"},{code:"HUA",name:"花蓮縣"},{code:"TTT",name:"臺東縣"},{code:"PEN",name:"澎湖縣"},{code:"KIN",name:"金門縣"},{code:"LIE",name:"連江縣"}]),k=b([]),v=b([]),Z={TPE:[{code:"ZS",name:"中山區"},{code:"DA",name:"大安區"},{code:"XY",name:"信義區"},{code:"SS",name:"松山區"},{code:"WH",name:"萬華區"},{code:"ZZ",name:"中正區"},{code:"DT",name:"大同區"},{code:"SL",name:"士林區"},{code:"BT",name:"北投區"},{code:"NH",name:"內湖區"},{code:"NG",name:"南港區"},{code:"WS",name:"文山區"}],KHH:[{code:"XZ",name:"新興區"},{code:"QJ",name:"前金區"},{code:"LY",name:"苓雅區"},{code:"YC",name:"鹽埕區"},{code:"GS",name:"鼓山區"},{code:"QZ",name:"前鎮區"},{code:"XL",name:"小港區"},{code:"ZS",name:"左營區"}]},z={ZS:[{code:"001",name:"中山段"},{code:"002",name:"長安段"},{code:"003",name:"民權段"}],DA:[{code:"001",name:"大安段"},{code:"002",name:"忠孝段"},{code:"003",name:"信義段"}]},H=re(()=>n.county&&n.district&&n.section&&n.landNumberMain&&!c.main&&!c.sub),F=async()=>{A.value=!0;try{const s=await $fetch(`/api/urban-renewals/${M.params.id}`,{baseURL:$.public.apiBaseUrl});if(s.status==="success")Object.assign(r,s.data);else throw new Error(s.message||"獲取資料失敗")}catch(s){console.error("Fetch error:",s),await h.fire({title:"載入失敗",text:"無法載入資料，請稍後再試",icon:"error",confirmButtonText:"確定",confirmButtonColor:"#ef4444"}),V.push("/tables/urban-renewal")}finally{A.value=!1}},R=()=>{document.title=`${r.name} - 更新會基本資料管理`},q=()=>{n.district="",n.section="",k.value=Z[n.county]||[],v.value=[]},K=()=>{n.section="",v.value=z[n.district]||[]},I=s=>{const t=s==="main"?n.landNumberMain:n.landNumberSub;t&&!/^\d{4}$/.test(t)?c[s]="請輸入4位數字格式（例：0001）":c[s]=""},O=()=>{var D,E,j;if(!H.value)return;const s=(D=P.value.find(w=>w.code===n.county))==null?void 0:D.name,t=(E=k.value.find(w=>w.code===n.district))==null?void 0:E.name,g=(j=v.value.find(w=>w.code===n.section))==null?void 0:j.name,o=n.landNumberSub?`${n.landNumberMain}-${n.landNumberSub}`:n.landNumberMain,L=`${s}${t}${g}${o}`,N={id:Date.now(),county:n.county,district:n.district,section:n.section,landNumberMain:n.landNumberMain,landNumberSub:n.landNumberSub,landNumber:o,fullLandNumber:L,landArea:n.landArea,isRepresentative:i.value.length===0};i.value.push(N),Object.assign(n,{county:"",district:"",section:"",landNumberMain:"",landNumberSub:"",landArea:""}),k.value=[],v.value=[]},Q=s=>{i.value.forEach(t=>t.isRepresentative=!1),s.isRepresentative=!0},X=s=>{f.value={...s},S.value=!0},B=()=>{S.value=!1,f.value={}},G=()=>{const s=i.value.findIndex(t=>t.id===f.value.id);s!==-1&&(i.value[s]={...f.value}),B()},W=async s=>{if(!(await h.fire({title:"確認刪除",text:`確定要刪除地號「${s.fullLandNumber}」嗎？`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"確定刪除",cancelButtonText:"取消"})).isConfirmed)return;const g=i.value.findIndex(o=>o.id===s.id);if(g!==-1){const o=s.isRepresentative;i.value.splice(g,1),o&&i.value.length>0&&(i.value[0].isRepresentative=!0)}},J=async()=>{y.value=!0;try{const s=await $fetch(`/api/urban-renewals/${M.params.id}`,{method:"PUT",baseURL:$.public.apiBaseUrl,headers:{"Content-Type":"application/json"},body:{name:r.name,area:parseFloat(r.area),member_count:parseInt(r.member_count),chairman_name:r.chairman_name,chairman_phone:r.chairman_phone,address:r.address,representative:r.representative}});if(s.status==="success")await h.fire({title:"儲存成功！",text:"資料已成功更新",icon:"success",confirmButtonText:"確定",confirmButtonColor:"#10b981"});else throw new Error(s.message||"儲存失敗")}catch(s){console.error("Save error:",s),await h.fire({title:"儲存失敗",text:s.message||"儲存失敗，請稍後再試",icon:"error",confirmButtonText:"確定",confirmButtonColor:"#ef4444"})}finally{y.value=!1}},ee=()=>{V.push("/tables/urban-renewal")};return ae(()=>r.name,R),de(()=>{F()}),(s,t)=>{const g=te;return a(),le(g,{name:"main"},{title:Y(()=>t[16]||(t[16]=[x("更新會基本資料管理")])),default:Y(()=>[e("div",ue,[e("div",me,[e("h1",ce,m(r.name||"載入中..."),1)]),A.value?(a(),d("div",be,t[17]||(t[17]=[e("div",{class:"flex items-center"},[e("svg",{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-green-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("span",{class:"text-lg text-gray-600"},"載入資料中...")],-1)]))):(a(),d("div",ge,[e("div",fe,[t[21]||(t[21]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"基本資訊",-1)),e("div",pe,[e("div",null,[t[18]||(t[18]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700 mb-2"},"更新會名稱",-1)),l(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=o=>r.name=o),type:"text",onInput:R,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入更新會名稱"},null,544),[[u,r.name]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"area",class:"block text-sm font-medium text-gray-700 mb-2"},"土地面積(平方公尺)",-1)),l(e("input",{id:"area","onUpdate:modelValue":t[1]||(t[1]=o=>r.area=o),type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入土地面積"},null,512),[[u,r.area]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"memberCount",class:"block text-sm font-medium text-gray-700 mb-2"},"所有權人數",-1)),l(e("input",{id:"memberCount","onUpdate:modelValue":t[2]||(t[2]=o=>r.member_count=o),type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入所有權人數"},null,512),[[u,r.member_count]])])])]),e("div",xe,[t[34]||(t[34]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"地號管理",-1)),e("div",ye,[t[31]||(t[31]=e("h3",{class:"text-md font-medium text-gray-900 mb-4"},"新增地號",-1)),e("div",ve,[e("div",null,[t[23]||(t[23]=e("label",{for:"county",class:"block text-sm font-medium text-gray-700 mb-2"},[x("縣市 "),e("span",{class:"text-red-500"},"*")],-1)),l(e("select",{id:"county","onUpdate:modelValue":t[3]||(t[3]=o=>n.county=o),onChange:q,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",required:""},[t[22]||(t[22]=e("option",{value:""},"請選擇縣市",-1)),(a(!0),d(C,null,_(P.value,o=>(a(),d("option",{key:o.code,value:o.code},m(o.name),9,we))),128))],544),[[U,n.county]])]),e("div",null,[t[25]||(t[25]=e("label",{for:"district",class:"block text-sm font-medium text-gray-700 mb-2"},[x("行政區 "),e("span",{class:"text-red-500"},"*")],-1)),l(e("select",{id:"district","onUpdate:modelValue":t[4]||(t[4]=o=>n.district=o),onChange:K,disabled:!n.county,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 disabled:bg-gray-100 disabled:cursor-not-allowed",required:""},[t[24]||(t[24]=e("option",{value:""},"請選擇行政區",-1)),(a(!0),d(C,null,_(k.value,o=>(a(),d("option",{key:o.code,value:o.code},m(o.name),9,ke))),128))],40,he),[[U,n.district]])]),e("div",null,[t[27]||(t[27]=e("label",{for:"section",class:"block text-sm font-medium text-gray-700 mb-2"},[x("段小段 "),e("span",{class:"text-red-500"},"*")],-1)),l(e("select",{id:"section","onUpdate:modelValue":t[5]||(t[5]=o=>n.section=o),disabled:!n.district,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 disabled:bg-gray-100 disabled:cursor-not-allowed",required:""},[t[26]||(t[26]=e("option",{value:""},"請選擇段小段",-1)),(a(!0),d(C,null,_(v.value,o=>(a(),d("option",{key:o.code,value:o.code},m(o.name),9,Ce))),128))],8,Ne),[[U,n.section]])]),e("div",null,[t[28]||(t[28]=e("label",{for:"landNumberMain",class:"block text-sm font-medium text-gray-700 mb-2"},[x("地號母號 "),e("span",{class:"text-red-500"},"*")],-1)),l(e("input",{id:"landNumberMain","onUpdate:modelValue":t[6]||(t[6]=o=>n.landNumberMain=o),type:"text",onInput:t[7]||(t[7]=o=>I("main")),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"例: 0001",maxlength:"4",required:""},null,544),[[u,n.landNumberMain]]),c.main?(a(),d("p",_e,m(c.main),1)):p("",!0)]),e("div",null,[t[29]||(t[29]=e("label",{for:"landNumberSub",class:"block text-sm font-medium text-gray-700 mb-2"},"地號子號",-1)),l(e("input",{id:"landNumberSub","onUpdate:modelValue":t[8]||(t[8]=o=>n.landNumberSub=o),type:"text",onInput:t[9]||(t[9]=o=>I("sub")),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"例: 0000",maxlength:"4"},null,544),[[u,n.landNumberSub]]),c.sub?(a(),d("p",Ae,m(c.sub),1)):p("",!0)]),e("div",null,[t[30]||(t[30]=e("label",{for:"landArea",class:"block text-sm font-medium text-gray-700 mb-2"},"土地總面積(平方公尺)",-1)),l(e("input",{id:"landArea","onUpdate:modelValue":t[10]||(t[10]=o=>n.landArea=o),type:"number",step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入土地面積"},null,512),[[u,n.landArea]])])]),e("div",Se,[e("button",{onClick:O,disabled:!H.value,class:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"}," 新增地號 ",8,Be)])]),e("div",Le,[e("div",Te,[e("table",Ue,[t[33]||(t[33]=e("thead",null,[e("tr",{class:"border-b border-gray-200 bg-gray-50"},[e("th",{class:"p-4 text-left text-sm font-medium text-gray-700"},"地號"),e("th",{class:"p-4 text-left text-sm font-medium text-gray-700"},"土地總面積(平方公尺)"),e("th",{class:"p-4 text-center text-sm font-medium text-gray-700"},"操作")])],-1)),e("tbody",null,[i.value.length===0?(a(),d("tr",Me,t[32]||(t[32]=[e("td",{colspan:"3",class:"p-8 text-center text-gray-500"}," 暫無地號資料，請新增地號 ",-1)]))):p("",!0),(a(!0),d(C,null,_(i.value,(o,L)=>(a(),d("tr",{key:o.id||L,class:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150"},[e("td",Ve,[e("div",$e,[e("span",null,m(o.fullLandNumber),1),o.isRepresentative?(a(),d("span",Pe," 代表號 ")):p("",!0)])]),e("td",He,m(o.landArea||"未設定"),1),e("td",Re,[e("div",Ie,[o.isRepresentative?(a(),d("span",Ee," 代表號 ")):(a(),d("button",{key:0,onClick:N=>Q(o),class:"px-2 py-1 text-xs font-medium text-white bg-blue-500 hover:bg-blue-600 rounded transition-colors duration-200"}," 設為代表號 ",8,De)),e("button",{onClick:N=>X(o),class:"px-2 py-1 text-xs font-medium text-white bg-green-500 hover:bg-green-600 rounded transition-colors duration-200"}," 編輯 ",8,je),e("button",{onClick:N=>W(o),class:"px-2 py-1 text-xs font-medium text-white bg-red-500 hover:bg-red-600 rounded transition-colors duration-200"}," 刪除 ",8,Ye)])])]))),128))])])])])]),e("div",Ze,[t[39]||(t[39]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"其他資訊",-1)),e("div",ze,[e("div",null,[t[35]||(t[35]=e("label",{for:"chairmanName",class:"block text-sm font-medium text-gray-700 mb-2"},"理事長姓名",-1)),l(e("input",{id:"chairmanName","onUpdate:modelValue":t[11]||(t[11]=o=>r.chairman_name=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入理事長姓名"},null,512),[[u,r.chairman_name]])]),e("div",null,[t[36]||(t[36]=e("label",{for:"chairmanPhone",class:"block text-sm font-medium text-gray-700 mb-2"},"理事長電話",-1)),l(e("input",{id:"chairmanPhone","onUpdate:modelValue":t[12]||(t[12]=o=>r.chairman_phone=o),type:"tel",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入理事長電話"},null,512),[[u,r.chairman_phone]])]),e("div",null,[t[37]||(t[37]=e("label",{for:"address",class:"block text-sm font-medium text-gray-700 mb-2"},"設立地址",-1)),l(e("input",{id:"address","onUpdate:modelValue":t[13]||(t[13]=o=>r.address=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入設立地址"},null,512),[[u,r.address]])]),e("div",null,[t[38]||(t[38]=e("label",{for:"representative",class:"block text-sm font-medium text-gray-700 mb-2"},"負責人",-1)),l(e("input",{id:"representative","onUpdate:modelValue":t[14]||(t[14]=o=>r.representative=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入負責人"},null,512),[[u,r.representative]])])])]),e("div",Fe,[e("button",{onClick:ee,class:"px-6 py-2 text-sm font-medium text-gray-700 bg-gray-300 border border-transparent rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200"}," 回上一頁 "),e("button",{onClick:J,disabled:y.value,class:"px-6 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[y.value?(a(),d("svg",Ke,t[40]||(t[40]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):p("",!0),x(" "+m(y.value?"儲存中...":"儲存"),1)],8,qe)])])),S.value?(a(),d("div",Oe,[e("div",Qe,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:B}),e("div",Xe,[t[42]||(t[42]=e("div",{class:"border-b border-gray-200 pb-4 mb-6"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"編輯地號")],-1)),e("div",Ge,[e("div",null,[t[41]||(t[41]=e("label",{for:"editLandArea",class:"block text-sm font-medium text-gray-700 mb-2"},"土地總面積(平方公尺)",-1)),l(e("input",{id:"editLandArea","onUpdate:modelValue":t[15]||(t[15]=o=>f.value.landArea=o),type:"number",step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"請輸入土地面積"},null,512),[[u,f.value.landArea]])])]),e("div",{class:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200"},[e("button",{type:"button",onClick:B,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200"}," 取消 "),e("button",{onClick:G,class:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200"}," 確認更新 ")])])])])):p("",!0)])]),_:1})}}};export{tt as default};

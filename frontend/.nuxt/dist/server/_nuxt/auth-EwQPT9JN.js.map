{"version":3,"file":"auth-EwQPT9JN.js","sources":["../../../../middleware/auth.js"],"sourcesContent":["export default defineNuxtRouteMiddleware(async (to) => {\r\n  const authStore = useAuthStore()\r\n  \r\n  // Skip middleware on server-side for better SSR handling\r\n  if (process.server) {\r\n    return\r\n  }\r\n  \r\n  // 初始化認證狀態 (只在客戶端運行)\r\n  await authStore.initializeAuth()\r\n  \r\n  // 檢查是否已登入且有有效token\r\n  if (!authStore.isLoggedIn) {\r\n    console.log('[Auth Middleware] User not authenticated, redirecting to login')\r\n    return navigateTo('/auth/login')\r\n  }\r\n  \r\n  // 嘗試驗證token是否仍然有效 (但不要太頻繁)\r\n  try {\r\n    // 只有當用戶數據不存在時才重新獲取\r\n    if (!authStore.user) {\r\n      await authStore.fetchUser()\r\n    }\r\n  } catch (error) {\r\n    console.warn('[Auth Middleware] Token validation failed:', error.message)\r\n    return navigateTo('/auth/login')\r\n  }\r\n})"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AACE,MAAA,iCAA+B,OAAA,OAAA;AAGX,eAAA;AAClB;AACF;AAAA,EAGA;;"}
import{x as H,r as b,a0 as J,ab as O,a as G,c as K,e as V,ac as Q,f as i,i as e,z as c,A as y,j as f,p as W,k as a,m as X,H as g,ad as h,C as d,F as Y,B as Z,ae as ee}from"./DnNEn_NX.js";import{_ as te}from"./BVOVxMHc.js";const oe={class:"p-8"},se={class:"bg-green-500 text-white p-6 rounded-lg mb-6"},ne={class:"flex items-center"},re={class:"bg-white/20 p-3 rounded-lg mr-4"},ae={class:"flex justify-end gap-4 mb-6"},le={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ie={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},de={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},ce={class:"border-b border-gray-200 pb-4 mb-6"},ue={class:"flex justify-between items-center"},me={class:"space-y-6"},be={key:0,class:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"},fe={class:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200"},ge=["disabled"],pe=["disabled"],xe={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},he={class:"bg-white rounded-lg shadow-sm border border-gray-200"},ye={class:"overflow-x-auto"},ve={class:"w-full"},we={key:0},_e={key:1},Ce={class:"p-4 text-sm text-gray-900"},ke={class:"p-4 text-sm text-gray-900 text-center"},Be={class:"p-4 text-sm text-gray-900 text-center"},Me={class:"p-4 text-sm text-gray-900"},Ne={class:"p-4 text-sm text-gray-900"},Ue={class:"p-4 text-center"},Ve={class:"flex justify-center gap-2 flex-wrap"},Re=["onClick"],Te=["onClick"],$e=["onClick"],Pe=["onClick"],Se={class:"flex justify-between items-center p-4 border-t border-gray-200"},je={class:"text-sm text-gray-500 flex items-center"},ze={class:"text-sm text-gray-500"},Ae={class:"flex gap-1"},De={disabled:"",class:"p-2 text-gray-400 bg-gray-100 rounded cursor-not-allowed"},Ee={disabled:"",class:"p-2 text-gray-400 bg-gray-100 rounded cursor-not-allowed"},Ie={__name:"urban-renewal",setup(Le){const{$swal:p}=H(),N=b(10),v=b(!1),w=b(!1),u=b(!1),l=b(""),s=J({name:"",area:"",memberCount:"",chairmanName:"",chairmanPhone:""}),m=b([]),_=Q(),R=O(),C=async()=>{w.value=!0,l.value="";try{const o=await $fetch("/api/urban-renewals",{baseURL:_.public.apiBaseUrl});o.status==="success"?m.value=o.data||[]:l.value=o.message||"獲取資料失敗"}catch(o){console.error("Fetch error:",o),l.value="無法連接到伺服器"}finally{w.value=!1}},T=async o=>{var t;try{return await $fetch("/api/urban-renewals",{method:"POST",baseURL:_.public.apiBaseUrl,headers:{"Content-Type":"application/json"},body:{name:o.name,area:parseFloat(o.area),memberCount:parseInt(o.memberCount),chairmanName:o.chairmanName,chairmanPhone:o.chairmanPhone}})}catch(r){throw console.error("Create error:",r),new Error(((t=r.data)==null?void 0:t.message)||"新增失敗")}},$=async o=>{var t;try{return await $fetch(`/api/urban-renewals/${o}`,{method:"DELETE",baseURL:_.public.apiBaseUrl})}catch(r){throw console.error("Delete error:",r),new Error(((t=r.data)==null?void 0:t.message)||"刪除失敗")}},P=()=>{console.log("Allocating renewal meeting")},S=()=>{v.value=!0},k=()=>{v.value=!1,j(),l.value=""},j=()=>{s.name="",s.area="",s.memberCount="",s.chairmanName="",s.chairmanPhone=""},z=()=>{const o=["大安區忠孝更新會","信義區松仁更新會","中山區民權更新會","萬華區西門更新會","士林區天母更新會","內湖區科技更新會","南港區經貿更新會","文山區木柵更新會","北投區石牌更新會","松山區民生更新會","中正區博愛更新會","大同區迪化更新會"],t=["陳志明","林美玲","王建國","張淑芬","李國華","劉玉婷","吳明德","黃秀英","鄭文昌","謝雅雯","周志偉","徐淑惠","蔡政宏","許雅琴","楊明峰","游淑華","賴志強","沈美珠","潘文傑","蘇雅雲"],r=o[Math.floor(Math.random()*o.length)],B=Math.floor(Math.random()*4500)+500,n=Math.floor(Math.random()*135)+15,M=t[Math.floor(Math.random()*t.length)],x=()=>{const U=["09"],F=U[Math.floor(Math.random()*U.length)],I=Math.floor(Math.random()*1e8).toString().padStart(8,"0");return F+I};s.name=r,s.area=B.toString(),s.memberCount=n.toString(),s.chairmanName=M,s.chairmanPhone=x()},A=async()=>{if(!s.name||!s.area||!s.memberCount||!s.chairmanName||!s.chairmanPhone){l.value="請填寫所有必填項目";return}u.value=!0,l.value="";try{const o=await T(s);o.status==="success"?(await C(),k(),p.fire({title:"新增成功！",text:"更新會已成功建立",icon:"success",confirmButtonText:"確定",confirmButtonColor:"#10b981"})):l.value=o.message||"新增失敗"}catch(o){l.value=o.message||"新增失敗，請稍後再試"}finally{u.value=!1}},D=o=>{R.push(`/tables/urban-renewal/${o.id}/basic-info`)},E=o=>{console.log("Viewing members for:",o)},L=o=>{console.log("Viewing joint info for:",o)},q=async o=>{if((await p.fire({title:"確認刪除",text:`確定要刪除「${o.name}」嗎？`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"確定刪除",cancelButtonText:"取消"})).isConfirmed)try{const r=await $(o.id);r.status==="success"?(await C(),p.fire({title:"刪除成功！",text:"更新會已成功刪除",icon:"success",confirmButtonText:"確定",confirmButtonColor:"#10b981"})):p.fire({title:"刪除失敗",text:r.message||"刪除失敗",icon:"error",confirmButtonText:"確定",confirmButtonColor:"#ef4444"})}catch(r){p.fire({title:"刪除失敗",text:r.message||"刪除失敗，請稍後再試",icon:"error",confirmButtonText:"確定",confirmButtonColor:"#ef4444"})}};return G(()=>{C()}),(o,t)=>{const r=W,B=te;return i(),K(B,{name:"main"},{title:V(()=>t[6]||(t[6]=[a("更新會管理")])),default:V(()=>[e("div",oe,[e("div",se,[e("div",ne,[e("div",re,[f(r,{name:"heroicons:document-text",class:"w-8 h-8 text-white"})]),t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold"},"更新會",-1))])]),e("div",ae,[e("button",{onClick:P,class:"inline-flex items-center px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-medium rounded-lg transition-colors duration-200"},[f(r,{name:"heroicons:users",class:"w-5 h-5 mr-2"}),t[8]||(t[8]=a(" 分配更新會 "))]),e("button",{onClick:S,class:"inline-flex items-center px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-medium rounded-lg transition-colors duration-200"},[f(r,{name:"heroicons:plus",class:"w-5 h-5 mr-2"}),t[9]||(t[9]=a(" 新建更新會 "))])]),v.value?(i(),c("div",le,[e("div",ie,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:k}),e("div",de,[e("div",ce,[e("div",ue,[t[11]||(t[11]=e("h3",{class:"text-lg font-semibold text-gray-900"},"新建更新會",-1)),e("button",{type:"button",onClick:z,class:"px-3 py-1 text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-md transition-colors duration-200"},[f(r,{name:"heroicons:beaker",class:"w-4 h-4 mr-1 inline"}),t[10]||(t[10]=a(" 填入測試資料 "))])])]),e("form",{onSubmit:X(A,["prevent"])},[e("div",me,[e("div",null,[t[12]||(t[12]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700 mb-2"},[a("更新會名稱 "),e("span",{class:"text-red-500"},"*")],-1)),g(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=n=>s.name=n),type:"text",placeholder:"請輸入更新會名稱",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",required:""},null,512),[[h,s.name]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"area",class:"block text-sm font-medium text-gray-700 mb-2"},[a("土地面積(平方公尺) "),e("span",{class:"text-red-500"},"*")],-1)),g(e("input",{id:"area","onUpdate:modelValue":t[1]||(t[1]=n=>s.area=n),type:"number",placeholder:"請輸入土地面積",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",required:""},null,512),[[h,s.area]])]),e("div",null,[t[14]||(t[14]=e("label",{for:"memberCount",class:"block text-sm font-medium text-gray-700 mb-2"},[a("所有權人數 "),e("span",{class:"text-red-500"},"*")],-1)),g(e("input",{id:"memberCount","onUpdate:modelValue":t[2]||(t[2]=n=>s.memberCount=n),type:"number",placeholder:"請輸入所有權人數",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",required:""},null,512),[[h,s.memberCount]])]),e("div",null,[t[15]||(t[15]=e("label",{for:"chairmanName",class:"block text-sm font-medium text-gray-700 mb-2"},[a("理事長姓名 "),e("span",{class:"text-red-500"},"*")],-1)),g(e("input",{id:"chairmanName","onUpdate:modelValue":t[3]||(t[3]=n=>s.chairmanName=n),type:"text",placeholder:"請輸入理事長姓名",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",required:""},null,512),[[h,s.chairmanName]])]),e("div",null,[t[16]||(t[16]=e("label",{for:"chairmanPhone",class:"block text-sm font-medium text-gray-700 mb-2"},[a("理事長電話 "),e("span",{class:"text-red-500"},"*")],-1)),g(e("input",{id:"chairmanPhone","onUpdate:modelValue":t[4]||(t[4]=n=>s.chairmanPhone=n),type:"tel",placeholder:"請輸入理事長電話",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",required:""},null,512),[[h,s.chairmanPhone]])])]),l.value?(i(),c("div",be,d(l.value),1)):y("",!0),e("div",fe,[e("button",{type:"button",onClick:k,disabled:u.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"}," 取消 ",8,ge),e("button",{type:"submit",disabled:u.value,class:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[u.value?(i(),c("svg",xe,t[17]||(t[17]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),a(" "+d(u.value?"新增中...":"確認新建"),1)],8,pe)])],32)])])])):y("",!0),e("div",he,[e("div",ye,[e("table",ve,[t[20]||(t[20]=e("thead",null,[e("tr",{class:"border-b border-gray-200"},[e("th",{class:"p-4 text-left text-sm font-medium text-gray-700"},"更新會名稱"),e("th",{class:"p-4 text-left text-sm font-medium text-gray-700"},"土地面積 (平方公尺)"),e("th",{class:"p-4 text-left text-sm font-medium text-gray-700"},"所有權人數"),e("th",{class:"p-4 text-left text-sm font-medium text-gray-700"},"理事長姓名"),e("th",{class:"p-4 text-left text-sm font-medium text-gray-700"},"理事長電話"),e("th",{class:"p-4 text-center text-sm font-medium text-gray-700"},"操作")])],-1)),e("tbody",null,[w.value?(i(),c("tr",we,t[18]||(t[18]=[e("td",{colspan:"6",class:"p-8 text-center text-gray-500"},[e("div",{class:"flex items-center justify-center"},[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),a(" 載入中... ")])],-1)]))):m.value.length===0?(i(),c("tr",_e,t[19]||(t[19]=[e("td",{colspan:"6",class:"p-8 text-center text-gray-500"}," 暫無資料，請點擊「新建更新會」新增資料 ",-1)]))):y("",!0),(i(!0),c(Y,null,Z(m.value,(n,M)=>(i(),c("tr",{key:n.id||M,class:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150"},[e("td",Ce,d(n.name),1),e("td",ke,d(n.area),1),e("td",Be,d(n.member_count),1),e("td",Me,d(n.chairman_name),1),e("td",Ne,d(n.chairman_phone),1),e("td",Ue,[e("div",Ve,[e("button",{onClick:x=>D(n),class:"px-2 py-1 text-xs font-medium text-white bg-green-500 hover:bg-green-600 rounded transition-colors duration-200"}," 基本資料 ",8,Re),e("button",{onClick:x=>E(n),class:"px-2 py-1 text-xs font-medium text-white bg-blue-500 hover:bg-blue-600 rounded transition-colors duration-200"}," 查詢會員 ",8,Te),e("button",{onClick:x=>L(n),class:"px-2 py-1 text-xs font-medium text-white bg-blue-500 hover:bg-blue-600 rounded transition-colors duration-200"}," 共舉資訊 ",8,$e),e("button",{onClick:x=>q(n),class:"px-2 py-1 text-xs font-medium text-white bg-red-500 hover:bg-red-600 rounded transition-colors duration-200"}," 刪除 ",8,Pe)])])]))),128))])])]),e("div",Se,[e("div",je,[t[22]||(t[22]=a(" 每頁顯示： ")),g(e("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>N.value=n),class:"ml-2 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"},t[21]||(t[21]=[e("option",{value:"10"},"10",-1),e("option",{value:"20"},"20",-1),e("option",{value:"50"},"50",-1)]),512),[[ee,N.value]])]),e("div",ze,d(m.value.length>0?`1-${m.value.length} 共 ${m.value.length}`:"0-0 共 0"),1),e("div",Ae,[e("button",De,[f(r,{name:"heroicons:chevron-left",class:"w-4 h-4"})]),t[23]||(t[23]=e("button",{class:"px-3 py-2 text-sm text-white bg-blue-500 rounded font-medium"},"1",-1)),e("button",Ee,[f(r,{name:"heroicons:chevron-right",class:"w-4 h-4"})])])])])])]),_:1})}}};export{Ie as default};

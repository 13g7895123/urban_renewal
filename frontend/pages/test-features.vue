<template>
  <div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 shadow-lg">
      <div class="container mx-auto">
        <h1 class="text-3xl font-bold mb-2">ğŸ§ª ç³»çµ±åŠŸèƒ½æ¸¬è©¦é é¢</h1>
        <p class="text-blue-100">ç°¡åŒ–ç‰ˆæ¸¬è©¦ä»‹é¢</p>
      </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto p-6">
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-bold mb-4">æ¸¬è©¦èªªæ˜</h2>
        <p class="mb-2">é€™æ˜¯ä¸€å€‹ç°¡åŒ–çš„æ¸¬è©¦é é¢ï¼Œç”¨æ–¼é©—è­‰ç³»çµ±åŠŸèƒ½ã€‚</p>
        <p class="text-sm text-gray-600">å¦‚æœä½ çœ‹åˆ°é€™æ®µæ–‡å­—ï¼Œè¡¨ç¤ºé é¢æ­£å¸¸é‹ä½œã€‚</p>
      </div>

      <!-- èªè­‰æ¸¬è©¦ -->
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-bold mb-4">ğŸ” èªè­‰åŠŸèƒ½æ¸¬è©¦</h2>
        
        <div class="space-y-4">
          <!-- è¨»å†Šæ¸¬è©¦ -->
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-2">1. è¨»å†Šæ–°ç”¨æˆ¶</h3>
            <div class="grid grid-cols-2 gap-3 mb-3">
              <input v-model="registerData.username" placeholder="ä½¿ç”¨è€…åç¨±" class="border rounded px-3 py-2" />
              <input v-model="registerData.email" type="email" placeholder="Email" class="border rounded px-3 py-2" />
              <input v-model="registerData.password" type="password" placeholder="å¯†ç¢¼" class="border rounded px-3 py-2" />
              <input v-model="registerData.full_name" placeholder="çœŸå¯¦å§“å" class="border rounded px-3 py-2" />
            </div>
            <button @click="testRegister" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
              æ¸¬è©¦è¨»å†Š
            </button>
            <div v-if="registerResult" class="mt-2 p-2 bg-gray-100 rounded text-sm">
              <pre>{{ registerResult }}</pre>
            </div>
          </div>

          <!-- ç™»å…¥æ¸¬è©¦ -->
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-2">2. ç™»å…¥</h3>
            <div class="grid grid-cols-2 gap-3 mb-3">
              <input v-model="loginData.email" type="email" placeholder="Email" class="border rounded px-3 py-2" />
              <input v-model="loginData.password" type="password" placeholder="å¯†ç¢¼" class="border rounded px-3 py-2" />
            </div>
            <button @click="testLogin" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
              æ¸¬è©¦ç™»å…¥
            </button>
            <div v-if="loginResult" class="mt-2 p-2 bg-gray-100 rounded text-sm">
              <pre>{{ loginResult }}</pre>
            </div>
          </div>

          <!-- å–å¾—ç”¨æˆ¶è³‡è¨Š -->
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-2">3. å–å¾—ç•¶å‰ç”¨æˆ¶è³‡è¨Š (éœ€è¦ç™»å…¥)</h3>
            <button @click="testGetMe" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
              æ¸¬è©¦å–å¾—ç”¨æˆ¶è³‡è¨Š
            </button>
            <div v-if="meResult" class="mt-2 p-2 bg-gray-100 rounded text-sm">
              <pre>{{ meResult }}</pre>
            </div>
          </div>
        </div>
      </div>

      <!-- æ›´æ–°æœƒç®¡ç†æ¸¬è©¦ -->
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-bold mb-4">ğŸ¢ æ›´æ–°æœƒç®¡ç†æ¸¬è©¦</h2>
        
        <div class="space-y-4">
          <!-- æŸ¥çœ‹æ›´æ–°æœƒåˆ—è¡¨ -->
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-2">1. æŸ¥çœ‹æ›´æ–°æœƒåˆ—è¡¨ (éœ€è¦ç™»å…¥)</h3>
            <button @click="testGetUrbanRenewals" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
              æ¸¬è©¦å–å¾—åˆ—è¡¨
            </button>
            <div v-if="urbanRenewalsResult" class="mt-2 p-2 bg-gray-100 rounded text-sm max-h-60 overflow-auto">
              <pre>{{ urbanRenewalsResult }}</pre>
            </div>
          </div>

          <!-- å»ºç«‹æ›´æ–°æœƒ -->
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-2">2. å»ºç«‹æ›´æ–°æœƒ (éœ€è¦ç™»å…¥)</h3>
            <div class="grid grid-cols-2 gap-3 mb-3">
              <input v-model="urbanRenewalData.name" placeholder="æ›´æ–°æœƒåç¨±" class="border rounded px-3 py-2" />
              <input v-model="urbanRenewalData.county" placeholder="ç¸£å¸‚" class="border rounded px-3 py-2" />
              <input v-model="urbanRenewalData.district" placeholder="é„‰é®å€" class="border rounded px-3 py-2" />
              <input v-model="urbanRenewalData.address" placeholder="åœ°å€" class="border rounded px-3 py-2" />
            </div>
            <button @click="testCreateUrbanRenewal" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
              æ¸¬è©¦å»ºç«‹
            </button>
            <div v-if="createUrbanRenewalResult" class="mt-2 p-2 bg-gray-100 rounded text-sm">
              <pre>{{ createUrbanRenewalResult }}</pre>
            </div>
          </div>
        </div>
      </div>

      <!-- API åŸºç¤ä½å€è¨­å®š -->
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <label class="block font-semibold mb-2">API åŸºç¤ä½å€:</label>
        <input v-model="apiBaseUrl" class="border rounded px-3 py-2 w-full" />
      </div>
    </div>
  </div>
</template>

<script setup>
definePageMeta({
  layout: false,
  middleware: []
})

// API åŸºç¤ä½å€
const apiBaseUrl = ref('http://localhost:8080')

// è¨»å†Šè³‡æ–™
const registerData = ref({
  username: '',
  email: '',
  password: '',
  full_name: ''
})
const registerResult = ref(null)

// ç™»å…¥è³‡æ–™
const loginData = ref({
  email: '',
  password: ''
})
const loginResult = ref(null)

// ç”¨æˆ¶è³‡è¨Š
const meResult = ref(null)

// æ›´æ–°æœƒè³‡æ–™
const urbanRenewalData = ref({
  name: '',
  county: '',
  district: '',
  address: ''
})
const urbanRenewalsResult = ref(null)
const createUrbanRenewalResult = ref(null)

// è¨»å†Šæ¸¬è©¦
const testRegister = async () => {
  try {
    const response = await $fetch(`${apiBaseUrl.value}/api/auth/register`, {
      method: 'POST',
      body: registerData.value
    })
    registerResult.value = JSON.stringify(response, null, 2)
  } catch (error) {
    registerResult.value = `éŒ¯èª¤: ${error.message}`
  }
}

// ç™»å…¥æ¸¬è©¦
const testLogin = async () => {
  try {
    const response = await $fetch(`${apiBaseUrl.value}/api/auth/login`, {
      method: 'POST',
      body: loginData.value,
      credentials: 'include'
    })
    loginResult.value = JSON.stringify(response, null, 2)
  } catch (error) {
    loginResult.value = `éŒ¯èª¤: ${error.message}`
  }
}

// å–å¾—ç”¨æˆ¶è³‡è¨Šæ¸¬è©¦
const testGetMe = async () => {
  try {
    const response = await $fetch(`${apiBaseUrl.value}/api/auth/me`, {
      method: 'GET',
      credentials: 'include'
    })
    meResult.value = JSON.stringify(response, null, 2)
  } catch (error) {
    meResult.value = `éŒ¯èª¤: ${error.message}`
  }
}

// å–å¾—æ›´æ–°æœƒåˆ—è¡¨
const testGetUrbanRenewals = async () => {
  try {
    const response = await $fetch(`${apiBaseUrl.value}/api/urban-renewals`, {
      method: 'GET',
      credentials: 'include'
    })
    urbanRenewalsResult.value = JSON.stringify(response, null, 2)
  } catch (error) {
    urbanRenewalsResult.value = `éŒ¯èª¤: ${error.message}`
  }
}

// å»ºç«‹æ›´æ–°æœƒ
const testCreateUrbanRenewal = async () => {
  try {
    const response = await $fetch(`${apiBaseUrl.value}/api/urban-renewals`, {
      method: 'POST',
      body: urbanRenewalData.value,
      credentials: 'include'
    })
    createUrbanRenewalResult.value = JSON.stringify(response, null, 2)
  } catch (error) {
    createUrbanRenewalResult.value = `éŒ¯èª¤: ${error.message}`
  }
}

// å…ƒä»¶æ›è¼‰æ™‚åˆå§‹åŒ–æ¸¬è©¦è³‡æ–™
onMounted(() => {
  const timestamp = Date.now()
  registerData.value.username = `testuser_${timestamp}`
  registerData.value.email = `test_${timestamp}@example.com`
  registerData.value.password = 'password123'
  registerData.value.full_name = 'æ¸¬è©¦ä½¿ç”¨è€…'
  
  loginData.value.email = 'admin@example.com'
  loginData.value.password = 'password123'
  
  urbanRenewalData.value.name = `æ¸¬è©¦æ›´æ–°æœƒ_${timestamp}`
  urbanRenewalData.value.county = 'è‡ºåŒ—å¸‚'
  urbanRenewalData.value.district = 'ä¸­æ­£å€'
  urbanRenewalData.value.address = 'æ¸¬è©¦åœ°å€123è™Ÿ'
})
</script>

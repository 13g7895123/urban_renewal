# 都市更新會管理系統 - 功能清單

## 使用者類型

系統分為兩大使用者類型:

### 1. 一般使用者 (General User)
- `user_type`: `general`
- 角色: `admin`, `chairman`, `member`, `observer`

### 2. 企業使用者 (Enterprise User)
- `user_type`: `enterprise`
- 角色: `admin`, `chairman`, `member`, `observer`
- 可設為企業管理者: `is_company_manager: 1`

---

## 一般使用者功能流程

### A. 認證與授權
1. **註冊** → 填寫基本資料 → 系統建立帳號
2. **登入** → 輸入帳密 → 取得JWT Token → 進入系統
3. **登出** → 清除Token
4. **忘記密碼** → 發送重設連結 → 重設密碼
5. **查看個人資料** → 修改基本資料 → 儲存
6. **變更密碼** → 輸入舊密碼和新密碼 → 更新

### B. 商城功能 (公開存取，無需登入)
1. **瀏覽商品** → 查看增開更新會/增加議題
2. **加入購物車** → 選擇數量 → 加入
3. **查看購物車** → 調整數量/移除商品
4. **前往結帳** (需登入) → 確認訂單 → 完成購買
5. **查看購買紀錄** (需登入) → 瀏覽歷史訂單

### C. 會議參與 (Member/Observer)
1. **查看會議列表** → 篩選會議
2. **查看會議詳情** → 查看議程/時間/地點
3. **會議報到** → 簽到/委託出席
4. **查看投票議題** → 瀏覽該會議的所有議題
5. **進行投票** → 選擇同意/不同意/棄權 → 送出
6. **查看投票結果** → 即時統計

### D. 通知功能
1. **接收通知** → 查看會議通知/投票通知
2. **標記已讀** → 單筆/批次/全部標記
3. **刪除通知**

---

## 企業使用者功能流程

### A. 企業管理者專屬功能

#### 1. 企業資料管理
- **查看企業資料** → 編輯企業資訊 → 儲存
- **取得邀請碼** → 分享給新成員
- **產生新邀請碼**

#### 2. 成員管理
- **查看待審核成員** → 審核通過/拒絕
- **查看企業成員列表** → 篩選管理者/一般成員
- **設定企業管理者** → 賦予管理權限
- **設定為一般成員** → 移除管理權限
- **新增成員** → 填寫資料 → 建立帳號
- **刪除成員**

#### 3. 更新會管理
- **查看管理的更新會列表** → 篩選/搜尋
- **建立新更新會** → 填寫基本資料 → 指派負責人 → 建立
  - 縣市/鄉鎮區/段
  - 理事長資訊
  - 地址/代表人
- **編輯更新會資料** → 修改基本資訊 → 儲存
- **刪除更新會**
- **批次指派更新會** → 選擇多個更新會 → 指派給企業管理者
- **指派成員到更新會** → 分配權限 → 確認
- **取消成員指派**

#### 4. 地號與建號管理
##### 地號 (Land Plot)
- **查看地號列表** → 依更新會篩選
- **新增地號** → 填寫段小段/地號/面積 → 建立
- **編輯地號** → 修改資料 → 儲存
- **刪除地號**
- **設定代表人** → 選擇代表地號

##### 建號 (Building)
- **查看建號列表** → 依更新會篩選  
- **新增建號** → 填寫段小段/建號/面積/地址 → 建立
- **編輯建號** → 修改資料 → 儲存
- **刪除建號**

##### 共同區域 (Joint Common Area)
- **查看共同區域列表**
- **新增共同區域** → 填寫名稱/面積/類型 → 建立
- **編輯共同區域** → 修改資料 → 儲存
- **刪除共同區域**

#### 5. 所有權人管理
- **查看所有權人列表** → 依更新會篩選
- **新增所有權人** → 填寫基本資料 → 建立
  - 姓名/身分證字號
  - 電話/聯絡地址/戶籍地址
  - 排除類型 (法院囑託查封/假扣押/假處分/破產登記/未經繼承)
  - 備註
- **編輯所有權人** → 修改資料 → 儲存
- **刪除所有權人**
- **匯入所有權人** → 上傳Excel → 批次建立
- **匯出所有權人** → 下載Excel
- **下載匯入範本**
- **查看所有建物資料** → 依更新會查看所有關聯建物

#### 6. 會議管理
- **查看會議列表** → 篩選狀態/類型/日期
- **建立會議** → 填寫會議資訊 → 建立
  - 會議名稱/類型 (會員大會/理事會/監事會/臨時會議)
  - 日期/時間/地點
  - 主席資訊
  - 成會門檻設定
  - 是否排除所有權人計算
- **編輯會議** → 修改會議資訊 → 儲存
- **刪除會議**
- **更新會議狀態** → draft/scheduled/in_progress/completed/cancelled
- **查看合格投票人快照** → 查看名單
- **重新整理快照** → 更新合格投票人名單

##### 出席管理
- **查看出席紀錄** → 依會議查看
- **會員報到** → 選擇所有權人 → 簽到/委託出席
- **批次報到** → 選擇多位 → 批次簽到
- **更新出席狀態** → 修改報到資訊 → 儲存
- **匯出出席紀錄** → 下載報表
- **查看出席統計** → 即時統計出席率

##### 會議文件匯出
- **匯出會議通知書** → 產生PDF
- **匯出簽到簿** → 產生PDF

#### 7. 投票議題管理
- **查看投票議題列表** → 依會議篩選
- **建立投票議題** → 填寫議題資訊 → 建立
  - 議題編號/標題/說明
  - 投票方式 (簡單多數/絕對多數/三分之二多數/全數同意)
  - 是否匿名投票
- **編輯投票議題** → 修改議題資訊 → 儲存
- **刪除投票議題**
- **開始投票** → 啟動議題投票
- **結束投票** → 關閉議題投票
- **查看投票統計** → 即時統計票數/面積權重
- **查看詳細投票紀錄** → 查看所有人投票情況
- **匯出投票結果** → 下載報表
- **重新計算權重** → 更新面積權重計算

#### 8. 投票功能
- **查看投票紀錄** → 依議題篩選
- **進行投票** → 選擇同意/不同意/棄權 → 送出
- **批次投票** → 多個議題一次投票
- **撤回投票** → 取消已投票項
- **查看個人投票** → 查看自己的投票紀錄

#### 9. 文件管理
- **查看文件列表** → 篩選類型/日期
- **上傳文件** → 選擇檔案 → 填寫資訊 → 上傳
- **批次上傳** → 選擇多個檔案 → 批次上傳
- **下載文件**
- **編輯文件資訊** → 修改名稱/說明 → 儲存
- **刪除文件**
- **查看最近文件** → 快速存取
- **查看儲存空間使用量** → 監控容量
- **清理孤立檔案** → 移除未關聯檔案

#### 10. 通知管理
- **查看通知列表** → 篩選類型/已讀未讀
- **建立通知** → 填寫內容 → 發送
- **建立會議通知** → 自動產生會議通知
- **建立投票通知** → 自動產生投票通知
- **標記已讀** → 單筆/批次/全部
- **刪除通知**
- **查看未讀數量**
- **查看通知統計**
- **清理過期通知**

#### 11. 系統設定 (Admin Only)
- **查看系統設定** → 依類別篩選
- **取得公開設定**
- **取得特定設定值**
- **設定系統參數** → 修改值 → 儲存
- **批次設定** → 多個參數一次更新
- **重設設定** → 恢復預設值
- **查看設定類別列表**
- **清除快取**
- **驗證設定值** → 檢查格式
- **查看系統資訊** → 監控系統狀態

#### 12. 使用者管理 (Admin Only)
- **查看使用者列表** → 篩選角色/狀態
- **查看使用者詳情**
- **新增使用者** → 填寫資料 → 建立帳號
- **編輯使用者** → 修改資料 → 儲存
- **刪除使用者**
- **切換使用者狀態** → 啟用/停用/暫停
- **重設登入嘗試次數**
- **設定為企業使用者**
- **設定為企業管理者**
- **搜尋使用者** → 關鍵字搜尋
- **角色統計** → 查看各角色人數
- **使用者統計** → 查看活躍度
- **變更使用者密碼** (Admin)

### B. 地區資料
- **查看縣市列表**
- **查看鄉鎮區列表** → 依縣市
- **查看段列表** → 依縣市/鄉鎮區
- **查看階層資料** → 完整三級結構

### C. 除錯工具 (Admin Only)
- **JWT除錯記錄** → 查看JWT驗證記錄
- **註冊記錄** → 查看使用者註冊日誌
- **清理除錯記錄**

---

## 功能權限對照表

| 功能模組 | Admin | Chairman | Member | Observer | 企業管理者 |
|---------|-------|----------|--------|----------|-----------|
| 認證授權 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 商城購買 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 個人資料 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 通知查看 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 會議查看 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 會議參與 | ✓ | ✓ | ✓ | - | ✓ |
| 投票權 | ✓ | ✓ | ✓ | - | ✓ |
| 更新會管理 | ✓ | - | - | - | ✓ |
| 會議管理 | ✓ | - | - | - | ✓ |
| 投票議題管理 | ✓ | - | - | - | ✓ |
| 所有權人管理 | ✓ | - | - | - | ✓ |
| 文件管理 | ✓ | - | - | - | ✓ |
| 企業管理 | ✓ | - | - | - | ✓ |
| 成員管理 | ✓ | - | - | - | ✓ |
| 使用者管理 | ✓ | - | - | - | - |
| 系統設定 | ✓ | - | - | - | - |
| 除錯工具 | ✓ | - | - | - | - |

---

## 主要業務流程

### 流程 1: 企業註冊與成員加入
```
1. 企業管理者註冊 → 2. 建立企業資料 → 3. 產生邀請碼 
→ 4. 新成員使用邀請碼註冊 → 5. 企業管理者審核 → 6. 成員加入企業
```

### 流程 2: 建立更新會完整流程
```
1. 建立更新會基本資料 → 2. 新增地號/建號 
→ 3. 新增所有權人 → 4. 設定持分關係 
→ 5. 指派企業成員管理 → 6. 開始運作
```

### 流程 3: 會議召開完整流程
```
1. 建立會議 → 2. 系統產生合格投票人快照 
→ 3. 發送會議通知 → 4. 會員報到 
→ 5. 建立投票議題 → 6. 開始投票 
→ 7. 會員投票 → 8. 結束投票 → 9. 查看結果 
→ 10. 匯出報表 → 11. 完成會議
```

### 流程 4: 購買商品流程
```
1. 瀏覽商城 (無需登入) → 2. 加入購物車 
→ 3. 調整數量 → 4. 前往結帳 (需登入) 
→ 5. 確認訂單 → 6. 完成付款 
→ 7. 查看購買紀錄 → 8. 服務開通
```

### 流程 5: 投票權重計算
```
1. 系統抓取所有權人土地持分 → 2. 計算土地面積權重
→ 3. 系統抓取所有權人建物持分 → 4. 計算建物面積權重
→ 5. 投票時同時計算人數/土地/建物三個維度
→ 6. 判定議題是否通過 (需同時滿足三個門檻)
```

---

## API 端點統計

- **認證相關**: 7個端點
- **使用者管理**: 14個端點
- **企業管理**: 11個端點
- **更新會管理**: 7個端點
- **地號管理**: 5個端點
- **建號管理**: 4個端點
- **共同區域**: 4個端點
- **所有權人**: 8個端點
- **會議管理**: 15個端點
- **出席管理**: 7個端點
- **投票議題**: 9個端點
- **投票**: 9個端點
- **通知**: 11個端點
- **文件**: 11個端點
- **系統設定**: 10個端點
- **地區資料**: 4個端點
- **除錯工具**: 6個端點

**總計: 142個API端點**

openapi: 3.0.3
info:
  title: 都更計票系統 - 共用定義
  description: 系統共用的 Schema 定義，包括錯誤回應、分頁、基礎欄位等
  version: 1.0.0

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Token 認證，格式為 Bearer <token>

  schemas:
    # ============ 通用回應結構 ============
    SuccessResponse:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          example: true
          description: 操作是否成功
        data:
          type: object
          description: 回應資料（依據不同 API 而定）
        message:
          type: string
          example: "操作成功"
          description: 成功訊息

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
          description: 操作是否成功
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              example: "VALIDATION_ERROR"
              description: 錯誤代碼
            message:
              type: string
              example: "驗證失敗"
              description: 錯誤訊息
            details:
              type: object
              description: 錯誤詳細資訊（可選）
              additionalProperties: true

    ValidationErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          required:
            - code
            - message
            - details
          properties:
            code:
              type: string
              example: "VALIDATION_ERROR"
            message:
              type: string
              example: "驗證失敗"
            details:
              type: object
              description: 欄位驗證錯誤詳情
              additionalProperties:
                type: string
              example:
                username: "帳號為必填"
                password: "密碼長度至少 6 個字元"

    # ============ 分頁 ============
    Pagination:
      type: object
      required:
        - current_page
        - per_page
        - total
        - total_pages
      properties:
        current_page:
          type: integer
          example: 1
          description: 當前頁碼
        per_page:
          type: integer
          example: 10
          description: 每頁筆數
        total:
          type: integer
          example: 100
          description: 總筆數
        total_pages:
          type: integer
          example: 10
          description: 總頁數

    PaginatedResponse:
      type: object
      required:
        - success
        - data
        - pagination
        - message
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            type: object
          description: 資料列表
        pagination:
          $ref: '#/components/schemas/Pagination'
        message:
          type: string
          example: "查詢成功"

    # ============ 基礎欄位 ============
    TimestampFields:
      type: object
      properties:
        created_at:
          type: string
          format: date-time
          example: "2025-10-08T10:30:00Z"
          description: 建立時間
        updated_at:
          type: string
          format: date-time
          example: "2025-10-08T15:45:00Z"
          description: 更新時間
        deleted_at:
          type: string
          format: date-time
          nullable: true
          example: null
          description: 刪除時間（軟刪除）

    # ============ ID 類型 ============
    ID:
      type: integer
      format: int64
      minimum: 1
      example: 1
      description: 唯一識別碼

    # ============ 日期時間格式 ============
    Date:
      type: string
      format: date
      example: "2025-10-08"
      description: 日期（YYYY-MM-DD）

    Time:
      type: string
      format: time
      example: "14:30:00"
      description: 時間（HH:MM:SS）

    DateTime:
      type: string
      format: date-time
      example: "2025-10-08T14:30:00Z"
      description: 日期時間（ISO 8601）

    # ============ 地址欄位 ============
    AddressFields:
      type: object
      properties:
        county:
          type: string
          maxLength: 10
          example: "台北市"
          description: 縣市
        district:
          type: string
          maxLength: 10
          example: "大安區"
          description: 鄉鎮市區
        address:
          type: string
          maxLength: 255
          example: "仁愛路四段 1 號"
          description: 詳細地址

    # ============ 聯絡欄位 ============
    ContactFields:
      type: object
      properties:
        phone:
          type: string
          maxLength: 20
          example: "02-12345678"
          description: 電話號碼
        mobile:
          type: string
          maxLength: 20
          example: "0912-345-678"
          description: 行動電話
        email:
          type: string
          format: email
          maxLength: 100
          example: "user@example.com"
          description: 電子郵件

    # ============ 會議類型 ============
    MeetingType:
      type: string
      enum:
        - 會員大會
        - 理事會
        - 監事會
        - 臨時會議
      example: "會員大會"
      description: 會議類型

    MeetingStatus:
      type: string
      enum:
        - draft
        - scheduled
        - in_progress
        - completed
        - cancelled
      example: "scheduled"
      description: |
        會議狀態：
        - draft: 草稿
        - scheduled: 已排程
        - in_progress: 進行中
        - completed: 已完成
        - cancelled: 已取消

    # ============ 報到類型 ============
    AttendanceType:
      type: string
      enum:
        - 親自出席
        - 委託出席
        - 列席
      example: "親自出席"
      description: |
        報到類型：
        - 親自出席: 本人親自到場
        - 委託出席: 委託他人代理
        - 列席: 列席但不計入法定人數

    # ============ 投票狀態 ============
    VotingStatus:
      type: string
      enum:
        - draft
        - open
        - closed
      example: "open"
      description: |
        投票狀態：
        - draft: 草稿
        - open: 投票中
        - closed: 已關閉

    VotingMethod:
      type: string
      enum:
        - 簡單多數
        - 絕對多數
        - 三分之二多數
        - 全體一致
      example: "絕對多數"
      description: |
        投票方式：
        - 簡單多數: 同意票數多於不同意票數
        - 絕對多數: 同意票數超過應出席人數的一半
        - 三分之二多數: 同意票數達應出席人數的三分之二
        - 全體一致: 所有人都同意

    VoteChoice:
      type: string
      enum:
        - 同意
        - 不同意
        - 棄權
      example: "同意"
      description: |
        投票選擇：
        - 同意: 贊成該議題
        - 不同意: 反對該議題
        - 棄權: 不表態

    # ============ 使用者角色 ============
    UserRole:
      type: string
      enum:
        - admin
        - manager
        - user
        - viewer
      example: "user"
      description: |
        使用者角色：
        - admin: 系統管理員
        - manager: 管理者
        - user: 一般使用者
        - viewer: 觀察者

    # ============ 所有權人排除類型 ============
    ExclusionType:
      type: string
      enum:
        - 法院囑託查封
        - 假扣押
        - 假處分
        - 破產登記
        - 未經繼承
      nullable: true
      example: null
      description: 所有權人排除類型（特殊狀態標記）

  # ============ 通用參數 ============
  parameters:
    PageParam:
      name: page
      in: query
      description: 頁碼（從 1 開始）
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1

    PerPageParam:
      name: per_page
      in: query
      description: 每頁筆數
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10
        example: 10

    SearchParam:
      name: search
      in: query
      description: 搜尋關鍵字
      required: false
      schema:
        type: string
        maxLength: 100
        example: "關鍵字"

    IDPathParam:
      name: id
      in: path
      description: 資源 ID
      required: true
      schema:
        type: integer
        format: int64
        minimum: 1
        example: 1

  # ============ 通用回應 ============
  responses:
    UnauthorizedError:
      description: 未授權（需要登入）
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "UNAUTHORIZED"
              message: "請重新登入"

    ForbiddenError:
      description: 禁止訪問（權限不足）
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "FORBIDDEN"
              message: "無權限執行此操作"

    NotFoundError:
      description: 資源不存在
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "NOT_FOUND"
              message: "找不到指定的資源"

    ValidationError:
      description: 驗證錯誤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationErrorResponse'

    InternalServerError:
      description: 伺服器內部錯誤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "INTERNAL_ERROR"
              message: "伺服器處理失敗"

    BadRequestError:
      description: 請求錯誤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "BAD_REQUEST"
              message: "請求參數錯誤"

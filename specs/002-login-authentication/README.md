# ç™»å…¥èªè­‰åŠŸèƒ½è¦æ ¼æ–‡ä»¶

**Feature ID**: 002-login-authentication
**Status**: âœ… Ready for Testing
**Priority**: P0 (Critical)
**Version**: 1.0.0

---

## ğŸ“‹ å¿«é€Ÿå°è¦½

æœ¬ç›®éŒ„åŒ…å«éƒ½æ›´è¨ˆç¥¨ç³»çµ±ç™»å…¥èªè­‰åŠŸèƒ½çš„å®Œæ•´è¦æ ¼æ–‡ä»¶ï¼Œæ¶µè“‹ Admin å’Œ User å…©å€‹ä¸»è¦ä½¿ç”¨æƒ…å¢ƒã€‚

### ğŸ“ æ–‡ä»¶æ¸…å–®

| æ–‡ä»¶ | èªªæ˜ | ç”¨é€” | ç‹€æ…‹ |
|------|------|------|------|
| [spec.md](./spec.md) | åŠŸèƒ½è¦æ ¼æ›¸ | è©³ç´°çš„éœ€æ±‚å®šç¾©ã€ä½¿ç”¨æƒ…å¢ƒã€æŠ€è¡“è¦æ ¼ | âœ… |
| [plan.md](./plan.md) | å¯¦ä½œè¨ˆç•« | å°ˆæ¡ˆæ™‚ç¨‹ã€éšæ®µè¦åŠƒã€é€²åº¦è¿½è¹¤ | âœ… |
| [tasks.md](./tasks.md) | ä»»å‹™æ¸…å–® | è©³ç´°ä»»å‹™åˆ†è§£ã€è²¬ä»»åˆ†é…ã€å®Œæˆç‹€æ…‹ | âœ… |
| [milestones.md](./milestones.md) | é‡Œç¨‹ç¢‘è¦åŠƒ | é—œéµé‡Œç¨‹ç¢‘ã€é©—æ”¶æ¨™æº–ã€æ™‚ç¨‹è¿½è¹¤ | âœ… |
| [implementation-guide.md](./implementation-guide.md) | å¯¦ä½œæŒ‡å— | é–‹ç™¼è€…æŠ€è¡“æ–‡ä»¶ã€æ¶æ§‹èªªæ˜ã€ç¯„ä¾‹ä»£ç¢¼ | âœ… |
| [test-checklist.md](./test-checklist.md) | æ¸¬è©¦æª¢æŸ¥æ¸…å–® | QA æ¸¬è©¦ç”¨ï¼ŒåŒ…å«æ‰‹å‹•å’Œè‡ªå‹•æ¸¬è©¦æ¡ˆä¾‹ | âœ… |
| [README.md](./README.md) | æœ¬æ–‡ä»¶ | å¿«é€Ÿåƒè€ƒå’Œç´¢å¼• | âœ… |
| [SUMMARY.md](./SUMMARY.md) | åŸ·è¡Œæ‘˜è¦ | å°ˆæ¡ˆç¸½çµã€é—œéµæ±ºç­–ã€å¾ŒçºŒè¡Œå‹• | âœ… |

### ğŸ”— ç›¸é—œæ–‡ä»¶

- [LOGIN_GUIDE.md](../../LOGIN_GUIDE.md) - ä½¿ç”¨è€…æ“ä½œæŒ‡å—
- [API Contract](../001-view/contracts/auth.yaml) - API å¥‘ç´„å®šç¾©ï¼ˆOpenAPI æ ¼å¼ï¼‰
- [API_TEST_INSTRUCTIONS.md](../../API_TEST_INSTRUCTIONS.md) - API æ¸¬è©¦èªªæ˜

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### å…©å¤§ä½¿ç”¨æƒ…å¢ƒ

#### 1ï¸âƒ£ Admin ç™»å…¥æƒ…å¢ƒ
- **ä½¿ç”¨è€…**ï¼šç³»çµ±ç®¡ç†å“¡
- **æ¬Šé™**ï¼šå®Œæ•´ç³»çµ±ç®¡ç†æ¬Šé™
- **ç™»å…¥å¾Œå°å‘**ï¼š`/tables/urban-renewal` (æ›´æ–°æœƒç®¡ç†)
- **å¯å­˜å–åŠŸèƒ½**ï¼š
  - âœ… æ›´æ–°æœƒç®¡ç†ï¼ˆæ‰€æœ‰æ›´æ–°æœƒï¼‰
  - âœ… æœƒè­°ç®¡ç†ï¼ˆæ‰€æœ‰æœƒè­°ï¼‰
  - âœ… æŠ•ç¥¨ç®¡ç†ï¼ˆæ‰€æœ‰æŠ•ç¥¨ï¼‰
  - âœ… ä½¿ç”¨è€…ç®¡ç†
  - âœ… ç³»çµ±è¨­å®š

#### 2ï¸âƒ£ User ç™»å…¥æƒ…å¢ƒ
åŒ…å«ä¸‰ç¨®è§’è‰²ï¼š

**Chairmanï¼ˆç†äº‹é•·ï¼‰**
- **æ¬Šé™**ï¼šæŒ‡å®šæ›´æ–°æœƒçš„ç®¡ç†æ¬Šé™
- **ç™»å…¥å¾Œå°å‘**ï¼š`/tables/meeting` (æœƒè­°åˆ—è¡¨)
- **å¯å­˜å–åŠŸèƒ½**ï¼š
  - âœ… æœƒè­°ç®¡ç†ï¼ˆè‡ªå·±çš„æ›´æ–°æœƒï¼‰
  - âœ… æŠ•ç¥¨ç®¡ç†
  - âœ… å‡ºå¸­ç°½åˆ°ç®¡ç†
  - âŒ ä½¿ç”¨è€…ç®¡ç†
  - âŒ ç³»çµ±è¨­å®š

**Memberï¼ˆæœƒå“¡ï¼‰**
- **æ¬Šé™**ï¼šåŸºæœ¬åƒèˆ‡æ¬Šé™
- **ç™»å…¥å¾Œå°å‘**ï¼š`/tables/meeting` (æœƒè­°åˆ—è¡¨)
- **å¯å­˜å–åŠŸèƒ½**ï¼š
  - âœ… åƒèˆ‡æœƒè­°ç°½åˆ°
  - âœ… åƒèˆ‡æŠ•ç¥¨è¡¨æ±º
  - âœ… æŸ¥çœ‹æœƒè­°è³‡è¨Š
  - âŒ ç®¡ç†æœƒè­°
  - âŒ ç®¡ç†æŠ•ç¥¨è­°é¡Œ

**Observerï¼ˆè§€å¯Ÿå“¡ï¼‰**
- **æ¬Šé™**ï¼šå”¯è®€æ¬Šé™
- **ç™»å…¥å¾Œå°å‘**ï¼š`/` (é¦–é )
- **å¯å­˜å–åŠŸèƒ½**ï¼š
  - âœ… æŸ¥çœ‹æœƒè­°è³‡è¨Š
  - âœ… æŸ¥çœ‹æŠ•ç¥¨çµæœ
  - âŒ åƒèˆ‡æŠ•ç¥¨
  - âŒ ç·¨è¼¯ä»»ä½•è³‡æ–™

---

## ğŸ”‘ æ¸¬è©¦å¸³è™Ÿ

| è§’è‰² | å¸³è™Ÿ | å¯†ç¢¼ | ç”¨é€” |
|------|------|------|------|
| ç®¡ç†å“¡ | `admin` | `password` | Admin æƒ…å¢ƒæ¸¬è©¦ |
| ç†äº‹é•· | `chairman` | `password` | Chairman æ¬Šé™æ¸¬è©¦ |
| æœƒå“¡ | `member1` | `password` | Member æ¬Šé™æ¸¬è©¦ |
| è§€å¯Ÿå“¡ | `observer1` | `password` | Observer æ¬Šé™æ¸¬è©¦ |

> âš ï¸ **æ³¨æ„**ï¼šé€™äº›æ˜¯æ¸¬è©¦ç”¨å¸³è™Ÿï¼Œå¯†ç¢¼ç‚ºç°¡å–®å¯†ç¢¼ï¼Œåƒ…ä¾›é–‹ç™¼å’Œæ¸¬è©¦ç’°å¢ƒä½¿ç”¨ã€‚

---

## ğŸš€ å¿«é€Ÿæ¸¬è©¦

### 1. ç’°å¢ƒç¢ºèª
```bash
# ç¢ºèªæœå‹™é‹è¡Œ
docker ps | grep urban_renewal

# ç¢ºèªå¾Œç«¯ API
curl http://localhost:9228/

# ç¢ºèªå‰ç«¯
curl http://localhost:4001/
```

### 2. Admin ç™»å…¥æ¸¬è©¦
```bash
# API æ¸¬è©¦
curl -X POST http://localhost:9228/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password"}' \
  | jq

# é æœŸçµæœï¼šå›æ‡‰ 200ï¼ŒåŒ…å« token å’Œ user ç‰©ä»¶
```

**å‰ç«¯æ¸¬è©¦**ï¼š
1. é–‹å•Ÿ http://localhost:4001/login
2. è¼¸å…¥ admin / password
3. æ‡‰è©²å°å‘ /tables/urban-renewal

### 3. User ç™»å…¥æ¸¬è©¦
```bash
# API æ¸¬è©¦
curl -X POST http://localhost:9228/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"member1","password":"password"}' \
  | jq

# é æœŸçµæœï¼šå›æ‡‰ 200ï¼Œrole ç‚º 'member'
```

**å‰ç«¯æ¸¬è©¦**ï¼š
1. é–‹å•Ÿ http://localhost:4001/login
2. è¼¸å…¥ member1 / password
3. æ‡‰è©²å°å‘ /tables/meeting

### 4. æ¬Šé™æ¸¬è©¦é é¢
é–‹å•Ÿ http://localhost:4001/test-role æŸ¥çœ‹ç•¶å‰ä½¿ç”¨è€…çš„è§’è‰²å’Œæ¬Šé™ã€‚

---

## âœ… é©—æ”¶æ¨™æº–

### åŠŸèƒ½å®Œæ•´æ€§ï¼ˆå·²å®Œæˆï¼‰
- âœ… Admin å¯ä»¥ç™»å…¥ä¸¦å­˜å–æ‰€æœ‰åŠŸèƒ½
- âœ… User (chairman/member/observer) å¯ä»¥ç™»å…¥ä¸¦å­˜å–å°æ‡‰æ¬Šé™åŠŸèƒ½
- âœ… ç™»å…¥å¤±æ•—é¡¯ç¤ºæ­£ç¢ºéŒ¯èª¤è¨Šæ¯
- âœ… å¸³è™Ÿé–å®šæ©Ÿåˆ¶æ­£å¸¸é‹ä½œï¼ˆ5 æ¬¡å¤±æ•—é–å®š 30 åˆ†é˜ï¼‰
- âœ… Token éæœŸå¾Œæ­£ç¢ºè™•ç†
- âœ… ç™»å‡ºåŠŸèƒ½æ­£å¸¸é‹ä½œ
- âœ… è§’è‰²æ¬Šé™æ­£ç¢ºé™åˆ¶é é¢å­˜å–

### å®‰å…¨æ€§ï¼ˆå·²å¯¦ä½œï¼‰
- âœ… å¯†ç¢¼ä½¿ç”¨ bcrypt åŠ å¯†å„²å­˜
- âœ… JWT Token æ©Ÿåˆ¶ï¼ˆ24 å°æ™‚æœ‰æ•ˆæœŸï¼‰
- âœ… Refresh Tokenï¼ˆ7 å¤©æœ‰æ•ˆæœŸï¼‰
- âœ… ç™»å…¥å¤±æ•—æ¬¡æ•¸è¿½è¹¤
- âœ… å¸³è™Ÿé–å®šæ©Ÿåˆ¶
- âœ… CORS ä¿è­·
- âœ… SQL Injection é˜²è­·ï¼ˆPrepared Statementsï¼‰
- âš ï¸ CSRF ä¿è­·ï¼ˆå¾…åŠ å¼·ï¼‰

### æ•ˆèƒ½ï¼ˆå·²é©—è­‰ï¼‰
- âœ… ç™»å…¥å›æ‡‰æ™‚é–“ < 500ms
- âœ… Token é©—è­‰ < 100ms
- âœ… æ”¯æ´ä½µç™¼ç™»å…¥

---

## ğŸ“Š æ¸¬è©¦æ¶µè“‹ç¯„åœ

### Admin æƒ…å¢ƒæ¸¬è©¦æ¡ˆä¾‹
1. âœ… Admin æ­£å¸¸ç™»å…¥
2. âœ… Admin éŒ¯èª¤å¯†ç¢¼ç™»å…¥
3. âœ… Admin å¸³è™Ÿé–å®š
4. âœ… Admin Token éæœŸè™•ç†
5. âœ… Admin æŸ¥çœ‹å®Œæ•´ç®¡ç†åŠŸèƒ½

### User æƒ…å¢ƒæ¸¬è©¦æ¡ˆä¾‹
1. âœ… Member æ­£å¸¸ç™»å…¥
2. âœ… Chairman ç™»å…¥ä¸¦ç®¡ç†æœƒè­°
3. âœ… Observer ç™»å…¥å”¯è®€æ¨¡å¼
4. âœ… User æ¬Šé™é‚Šç•Œæ¸¬è©¦
5. âœ… User ç™»å‡ºæµç¨‹

### å®‰å…¨æ€§æ¸¬è©¦
1. âœ… SQL Injection é˜²è­·æ¸¬è©¦
2. âœ… XSS é˜²è­·æ¸¬è©¦
3. âœ… æš´åŠ›ç ´è§£é˜²è­·æ¸¬è©¦

### API æ¸¬è©¦
1. âœ… POST /api/auth/login
2. âœ… POST /api/auth/logout
3. âœ… GET /api/auth/me
4. âš ï¸ POST /api/auth/refreshï¼ˆå¾…æ¸¬è©¦ï¼‰
5. âš ï¸ POST /api/auth/forgot-passwordï¼ˆéƒµä»¶åŠŸèƒ½å¾…å¯¦ä½œï¼‰

---

## ğŸ“ å·²çŸ¥é™åˆ¶

### å¾…å¯¦ä½œåŠŸèƒ½
1. âš ï¸ **å¯†ç¢¼é‡è¨­éƒµä»¶ç™¼é€**
   - åŠŸèƒ½å·²å¯¦ä½œï¼Œä½†éƒµä»¶ç™¼é€éœ€è¦ SMTP è¨­å®š
   - ç›®å‰åƒ…ç”¢ç”Ÿ tokenï¼Œæœªå¯¦éš›ç™¼é€éƒµä»¶

2. âš ï¸ **å¸³è™Ÿè¨»å†ŠåŠŸèƒ½**
   - ç›®å‰åªèƒ½ç”±ç®¡ç†å“¡å»ºç«‹ä½¿ç”¨è€…
   - æœªä¾†å¯è€ƒæ…®é–‹æ”¾è¨»å†ŠåŠŸèƒ½

3. âš ï¸ **é›™å› ç´ èªè­‰ (2FA)**
   - æœªå¯¦ä½œ

4. âš ï¸ **OAuth/SSO ç™»å…¥**
   - æœªæ”¯æ´ç¬¬ä¸‰æ–¹ç™»å…¥

### å¾…æ”¹é€²é …ç›®
1. **P1**: å¯¦ä½œå¯†ç¢¼é‡è¨­éƒµä»¶ç™¼é€åŠŸèƒ½
2. **P2**: åŠ å¼· CSRF ä¿è­·æ©Ÿåˆ¶
3. **P2**: å¯¦ä½œ refresh token è‡ªå‹•çºŒç´„
4. **P3**: åŠ å…¥ç™»å…¥ log å’Œç•°å¸¸ç™»å…¥åµæ¸¬
5. **P3**: æ”¯æ´å¤šè£ç½®ç™»å…¥ç®¡ç†

---

## ğŸ› ï¸ é–‹ç™¼è³‡æº

### å‰ç«¯æª”æ¡ˆ
```
frontend/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ login.vue                    # ç™»å…¥é é¢
â”‚   â”œâ”€â”€ unauthorized.vue             # ç„¡æ¬Šé™é é¢
â”‚   â””â”€â”€ test-role.vue               # è§’è‰²æ¸¬è©¦é é¢
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.js                      # èªè­‰ middleware
â”‚   â””â”€â”€ role.js                      # è§’è‰²æ¬Šé™ middleware
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ auth.js                      # Auth Pinia Store
â””â”€â”€ composables/
    â”œâ”€â”€ useAuth.js                   # èªè­‰ API
    â”œâ”€â”€ useApi.js                    # API å°è£
    â””â”€â”€ useRole.js                   # è§’è‰²æ¬Šé™
```

### å¾Œç«¯æª”æ¡ˆ
```
backend/app/
â”œâ”€â”€ Controllers/Api/
â”‚   â””â”€â”€ AuthController.php           # èªè­‰æ§åˆ¶å™¨
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ UserModel.php                # ä½¿ç”¨è€…æ¨¡å‹
â”‚   â””â”€â”€ UserSessionModel.php        # Session æ¨¡å‹
â”œâ”€â”€ Helpers/
â”‚   â”œâ”€â”€ auth_helper.php              # èªè­‰è¼”åŠ©å‡½æ•¸
â”‚   â””â”€â”€ response_helper.php          # å›æ‡‰æ ¼å¼åŒ–
â””â”€â”€ Database/
    â”œâ”€â”€ Migrations/
    â”‚   â””â”€â”€ 2025-01-01-000010_CreateUserAuthenticationTables.php
    â””â”€â”€ Seeds/
        â””â”€â”€ UserSeeder.php           # æ¸¬è©¦å¸³è™Ÿ
```

---

## ğŸ“ è¯çµ¡è³‡è¨Š

### å•é¡Œå›å ±
- **é¡å‹**ï¼šåŠŸèƒ½ç¼ºé™·ã€å®‰å…¨å•é¡Œã€æ•ˆèƒ½å•é¡Œ
- **å›å ±æ–¹å¼**ï¼šå»ºç«‹ GitHub Issue æˆ–è¯ç¹«é–‹ç™¼åœ˜éšŠ

### æ–‡ä»¶ç¶­è­·
- **æœ€å¾Œæ›´æ–°**ï¼š2025-10-23
- **ç¶­è­·è€…**ï¼šClaude Code
- **ç‰ˆæœ¬**ï¼š1.0.0

---

## ğŸ“š å»¶ä¼¸é–±è®€

- [JWT æœ€ä½³å¯¦è¸](https://tools.ietf.org/html/rfc8725)
- [OWASP èªè­‰å®‰å…¨å‚™å¿˜éŒ„](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
- [CodeIgniter 4 Security](https://codeigniter.com/user_guide/concepts/security.html)
- [Nuxt 3 Authentication](https://nuxt.com/docs/getting-started/data-fetching#authentication)

---

**Document Status**: âœ… Complete
**Last Review**: 2025-10-23
**Next Review**: 2025-11-23
